<!DOCTYPE group PUBLIC
          "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<group>

%tableofcontents;

<p>This page introduces the notion of frame of a local feature, as
used extensively in VLFeat.  A <em>feature frame</em> or simply
a <em>frame</em>, is a geometric object such as a point, a circle, or
an ellipse representing the location and shape of an image
feature. Frames are closed under certain classes of transformations of
the plane and can be used in co-variant detectors.</p>

<h1>Types of frames</h1>

<p>VLFeat uses five types of frames:</p>

<ul>
<li><em>points</em> defined by their center $(x,y)$;</li>
<li><em>circles</em> defined by their center $(x,y)$ and radius
$\sigma$;</li>
<li><em>ellipses</em> defined by their center $T = (x,y)$, and a
positive semidefinte matrix $\Sigma$ such that the ellipse is the set
of points $\{\bx \in \real^2: (\bx-T)^\top\Sigma^{-1}(\bx-T)=1\}$;</li>
<li><em>oriented circles</em> defined by their center $(x,y)$, their
radius $\sigma$, and rotation $\theta$;</li>
<li>and <em>oriented ellipses</em> defined by an affine transformation
$(A,T)$, where $A\in\real^{2\times2}$ is the linear component and
$T\in\real^2$ the translation.</li>
</ul>

<p>Each frame type can then be represented by 2, 3, 4, 5, or 6 numbers
respectively, encoded in a vector <code>frame</code> of the
corresponding length, using the conventions detailed
in <code>vl_plotframe</code>.</p>

<p>While unoriented frames (points, circles, and ellipses) are easy to
understand, a few words should be spent illustrating
their <em>oriented</em> variants. On an elementary level, an oriented
circle is a circle with a radius pointing downwards, such as the
following:</p>

<div class="figure">
 <img src="%pathto:root;demo/frame_standard.jpg"/>
 <div class="caption">
  <span class="content">
    The standard oriented frame: a unit circle, centered at the
    origin, with a radius pointing downwards. This correspond to an
    oriented disc with null translation, unit radius, and null
    rotation; alternatively, this corresponds to an oriented ellipse
    with affine transformation $(I,0)$. Figure generated
    by <code>vl_demo_frame</code>.
  </span>
 </div>
</div>

<p>The radius is used to represent the <em>orientation</em> of the
frame. This figure was generated by using
the <code>vl_plotframe</code> function:</p>

<precode type='matlab'>
A = eye(2) ;
T = [0;0] ;
f = [T ; A(:)] ;
vl_plotframe(f) ;
</precode>

<p>This frame is called <bf>standard</bf> and corresponds to the
identity affine transformation. Since this ellipse is also a circle,
the frame can equivalently be represented by an oriented circle with
unit radius and null orientation:</p>

<precode type='matlab'>
radius = 1 ;
theta = 0 ;
f = [T ; radius ; theta] ;
vl_plotframe(f) ;
</precode>

<p>A positive rotation of the frame appears clockwise because the
image coordinate system is left-handed (Y axis pointing
downwards):</p>

<div class="figure">
 <img src="%pathto:root;demo/frame_rotated.jpg"/>
 <div class="caption">
  <span class="content">
    A frame rotated by 45 degrees; note that the rotation is
    clockwise: this is because the image uses a left-handed coordinate
    system (Y axis pointing downwards). Figure generated
    by <code>vl_demo_frame</code>.
  </span>
 </div>
</div>

<precode type='matlab'>
radius = 1 ;
theta = pi/4 ;
f = [T ; radius ; theta] ;
vl_plotframe(f) ;
</precode>

<p>Frames are sometimes used to specify image regions; more
fundamentally, however, they specify <em>image
transformations</em>. In particular, all oriented frames can be
obtained through a unique affine transformation of the standard frame
shown above. We call this unique affine transformation the
map <em>specified</em> by the frame.</p>

<p>The affine transformation $(A,T)$ is encoded explicitly in
the <code>frame</code> vector in the case of oriented ellipse:</p>

<div class="figure">
 <img src="%pathto:root;demo/frame_affine.jpg"/>
 <div class="caption">
  <span class="content">
    An oriented ellipse is specified as the affine transformation
    $(A,T)$ of the standard oriented frame shown above. Figure
    generated by <code>vl_demo_frame</code>.
  </span>
 </div>
</div>

<precode type='matlab'>
f = [T ; A(:)] ;
vl_plotframe(f) ;
</precode>

<p>Note that, when features extracted by a detector such
as <code>vl_covdet</code> or <code>vl_sift</code>, are normalized, this
is done by applying the affine transformation which is
the <em>inverse</em> of the one specified by the feature frame; in
this way, in fact, the frame is transformed back to its standardized
version.</p>

<p>Similarly, unoriented frames can all be seen as affine
transformations of the standard unoriented frame (the unit circle
centered at the origin). In this case, however, the affine
transformation $(A,T)$ is not unique but determined up to a rotation
$(AR, T)$.</p>

<p>When this ambiguity exists and an affine transformation $(A,T)$
needs to be selected, it is customary to choose $R$ such that the Y
axis of the image is mapped onto itself (see below).</p>

<h1>Converting frames</h1>

<p>All oriented frames are special cases of oriented ellipses. Thus an
oriented disc can be immediately rewritten as an oriented ellipse, as
done by the <code>vl_frame2oell</code> function. Likewise, unoriented
frames can be immediately rewritten as unoriented ellipse.</p>

<p>Things are more interesting when an unoriented frame is converted
into an oriented one. In this case, an arbitrary orientation is
selected in such a way that the affine transformation $(A,T)$
specified by the resulting frame maps the Y axis to itself:</p>

\[
  A\begin{bmatrix}1\\ 0\end{bmatrix} \propto \begin{bmatrix}1\\ 0\end{bmatrix}.
\]

<p>This effect can be better understood by starting from some oriented
frames, removing the orientation, and then
using <code>vl_frame2oell</code> to generate oriented ellipses back:
in the process, orientation information is lost and replaced by a
convectional orientation:</p>.

<div class="figure">
 <img src="%pathto:root;demo/frame_frame2oell.jpg"/>
 <div class="caption">
  <span class="content">
    Top: randomly sampled oriented ellipses. Middle: the same ellipses
    with the orientation removed. Bottom: oriented ellipses again,
    obtained by calling <code>vl_frame2oell</code>; note that the
    orientation is upright. Figure generated
    by <code>vl_demo_frame</code>.
  </span>
 </div>
</div>

</group>
